<div id="comment-{% if include.replying_to != '' %}{{ include.replying_to }}-{% endif %}{{ include.index }}" class="comment">
  <div class="comment-header">
    {% if include.replying_to == "" %}
      <hr class="comment-separator">
    {% else %}
      <hr class="comment-separator comment-reply-separator">
    {% endif %}
    <div class="comment-avatar">
      {% if include.website != "" %}
        <a href="{{ include.website }}" title="Link to author's website">
      {% endif %}
      <img src="https://www.gravatar.com/avatar/{{ include.email }}?d=mm&s=50" alt="{{ include.name | escape }}">
      {% if include.website != "" %}
        </a>
      {% endif %}
    </div>
    <div class="comment-title">
      {% if include.website != "" %}
        <a href="{{ include.website }}" title="Link to author's website">
      {% endif %}
      <span class="comment-author">{{ include.name }}</span>
      {% if include.website != "" %}
        </a>
      {% endif %}
      <br>
      <a href="#comment-{{ include.index }}" title="Permalink to this comment">
        {%- assign date_format = site.minima.date_format | default: "%b %-d, %Y" -%}
        {% if include.replying_to == "" %}commented{% else %}replied{% endif %} on {{ include.timestamp | divided_by: 1000 | date: date_format }}
      </a>
    </div>
    {% if include.replying_to == "" %}
      <hr class="comment-separator-end">
    {% else %}
      <hr class="comment-separator-end comment-reply-separator">
    {% endif %}
  </div>
  <div class="comment-body">
    {{ include.message | strip_html | markdownify }}
  </div>
</div>

{% if include.replying_to == "" %}
  <div id="comment-form-container-{{ include.index }}" class="comment-form-container">
    <div id="comment-form-button-{{ include.index }}">
      <p class="comment-form-link" onclick="STATICMAN.moveForm('{{ include.index }}', 'Reply to <span class=&quot;comment-author&quot;>{{ include.name }}</span>')" rel="nofollow">
         <span class="comment-form-link-reply-symbol">&nbsp;&#11176;&nbsp;</span> Reply to <span class="comment-author">{{ include.name }}</span>
      </p>
    </div>
  </div>

  <div class="comment-replies">
    {% capture i %}{{ include.index }}{% endcapture %}
    {% assign replies = site.data.comments[page.slug] | where_exp: "item", "item.replying_to == i" %}
    {% assign replies_by_date = replies | sort: "_timestamp" | reverse %}
    {% for reply in replies_by_date %}
      {% assign index       = forloop.length | plus: 1 | minus: forloop.index %}
      {% assign replying_to = reply.replying_to %}
      {% assign name        = reply.name %}
      {% assign email       = reply.email %}
      {% assign website     = reply.website %}
      {% assign message     = reply.message %}
      {% assign timestamp   = reply._timestamp %}
      {% assign uid         = reply._id %}
      {% include staticman_comment.html index=index replying_to=replying_to name=name email=email website=website message=message timestamp=timestamp uid=uid %}
    {% endfor %}
  </div>
{% endif %}
